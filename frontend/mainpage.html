<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Ransomware Behavior Analytics</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 30px;
            background: #f5f6fa;
        }
        h1 {
            font-size: 28px;
            margin-bottom: 20px;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            background: #373737;
            color: white;
            border-radius: 6px;
            cursor: pointer;
        }
        button:disabled {
            background: #777;
        }
        .chart_results {
            display: flex;
            gap: 20px;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        .chart_results .chart-container {
            flex: 1;
            min-width: 300px;
        }
    </style>
</head>
<body>

    <h1>Ransomware Behavior Analytics üîç</h1>

    <!-- sample ÏÑ†ÌÉù(ÎØºÍ≤Ω) - start -->
    <div class="card">
        <h1>Autoencoder Model ü§ñ</h1>
        <h2>Choose for samples of Ransomware Behavior Analytics</h2>
        ‚≠ï Multiple selection possible‚≠ï
        <div id="checkbox_container" style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;">

        </div>
        <button id="trainBtn">Î™®Îç∏ ÌõàÎ†® ÏãúÏûë</button>

        <div id="progress_container" style="display:none; margin-top: 20px;">
            <div style="width: 100%; background-color: #e0e0e0; border-radius: 8px;">
                <div id="progress_bar" style="width: 0%; height: 24px; background-color: #4caf50; border-radius: 8px; transition: width 0.4s ease;"></div>
            </div>
            <p id="progress_text" style="text-align: center; margin-top: 5px; font-weight: bold; color: #555;">0%</p>
        </div>

        <p id="status"></p>
    </div>
    <!-- sample ÏÑ†ÌÉù (ÎØºÍ≤Ω) - end -->


    <!-- SampleÎì§Ïùò Threshold Í∑∏ÎûòÌîÑ ÌëúÏãúÌïòÍ∏∞(ÏäπÏö¥) -start -->


    <!-- SampleÎì§Ïùò Threshold Í∑∏ÎûòÌîÑ ÌëúÏãúÌïòÍ∏∞(ÏäπÏö¥) -end -->


    <!-- Autoencoder Í≤∞Í≥º -->
    <div id="ae_section" class="card" style="display:none;">
        <h2>Autoencoder Í≤∞Í≥º</h2>
        <div class="chart_results"><div class="chart-container">
            <canvas id="ae_loss"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="ae_acc"></canvas>
        </div>
        </div>
    </div>


    <!-- class Î∂ÑÎ•ò Í∑∏ÎûòÌîÑ ÌëúÏãúÌïòÍ∏∞(ÏäπÌù¨) -start  -->


    <!-- class Î∂ÑÎ•ò Í∑∏ÎûòÌîÑ ÌëúÏãúÌïòÍ∏∞(ÏäπÌù¨) -end  -->


    <!-- LSTM Í≤∞Í≥º -->
    <div id="lstm_section" class="card" style="display:none;">
        <h2>LSTM Î™®Îç∏ Í≤∞Í≥º</h2>

        <div class="chart_results"><div class="chart-container">
            <canvas id="lstm_loss"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="lstm_acc"></canvas>
        </div>
        </div>
    </div>


    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // ===================================================
        // 1) ÏÑúÎ≤ÑÏóêÏÑú sample_id Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞ Î∞è Ï≤¥ÌÅ¨ Î∞ïÏä§ ÏÉùÏÑ±
        // ===================================================
        async function loadSamples() {
            const res = await fetch("/samples/");
            const data = await res.json();

            const container = document.getElementById("checkbox_container");

            data.sample_ids.forEach(id => {
                const label = document.createElement("label");
                label.style.display = "block";

                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.value = id;
                checkbox.name = "sample_id_checkbox";
                checkbox.style.marginRight = "5px";

                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(id));
                container.appendChild(label);
            });
        }

        loadSamples();

        // ===================================================
        // 2) Î™®Îç∏ ÌõàÎ†® ÏöîÏ≤≠
        // ===================================================
        document.getElementById("trainBtn").onclick = async () => {

            const select = document.getElementById("class_select");
            const checkboxes = document.querySelectorAll('#checkbox_container input[type="checkbox"]:checked')

        
            // ÏÑ†ÌÉùÍ∞í Í≤ÄÏ¶ù
            const selectedValues = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(ch => ch.value); // Î¨∏ÏûêÏó¥ Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©('sample_00000')

            if (selectedValues.length === 0) {
                alert("ÌõàÎ†®Ìï† ÏÉòÌîåÏùÑ ÌïòÎÇò Ïù¥ÏÉÅ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.")
                return;
            }
            
            // UI Ï¥àÍ∏∞Ìôî
            status.textContent = "Î™®Îç∏ ÌõàÎ†® Ï§ë... Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.";
            document.getElementById("trainBtn").disabled = true;

            // Í∑∏ÎûòÌîÑ ÏòÅÏó≠ Ïà®Í∏∞Í∏∞ (Ïû¨ÌõàÎ†® Ïãú)
            document.getElementById("ae_section").style.display = "none";
            document.getElementById("lstm_section").style.display = "none";


            // Ïä§Ìä∏Î¶¨Î∞ç ÏöîÏ≤≠
            const response = await fetch("/train/", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ sample_ids: selectedValues })
            });


            // Í≤∞Í≥º
            const data = await response.json();
            document.getElementById("trainBtn").disabled = false;

            // 500 error Ïãú, Ïò§Î•ò Î©îÏãúÏßÄ Ï∂úÎ†•
            if (response.status !==200 || data.error) {
                status.textContent = "Ïò§Î•ò Î∞úÏÉù: " + (data.error || "ÏÑúÎ≤Ñ ÏùëÎãµ Ïò§Î•ò");
                return;
            }

            status.textContent = "ÌõàÎ†® ÏôÑÎ£å! ÏïÑÎûò Í∑∏ÎûòÌîÑÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî."

            renderAutoencoderCharts(data.results.autoencoder);
            renderLstmCharts(data.results.lstm);

        }

        // ===================================================
        // 3) Autoencoder Í∑∏ÎûòÌîÑ
        // ===================================================
        function renderAutoencoderCharts(ae) {
            document.getElementById("ae_section").style.display = "block";

            new Chart(document.getElementById("ae_loss"), {
                type: "line",
                data: {
                    labels: ae.loss.map((_, i) => i + 1),
                    datasets: [
                        { label: "Loss", data: ae.loss, borderWidth: 2 },
                        { label: "Val Loss", data: ae.val_loss, borderWidth: 2 }
                    ]
                }
            });

            new Chart(document.getElementById("ae_acc"), {
                type: "line",
                data: {
                    labels: ae.accuracy.map((_, i) => i + 1),
                    datasets: [
                        { label: "Accuracy", data: ae.accuracy, borderWidth: 2 },
                        { label: "Val Accuracy", data: ae.val_accuracy, borderWidth: 2 }
                    ]
                }
            });
        }


        // ===================================================
        // 4) LSTM Í∑∏ÎûòÌîÑ
        // ===================================================
        function renderLstmCharts(lstm) {
            document.getElementById("lstm_section").style.display = "block";

            new Chart(document.getElementById("lstm_loss"), {
                type: "line",
                data: {
                    labels: lstm.loss.map((_, i) => i + 1),
                    datasets: [
                        { label: "Loss", data: lstm.loss, borderWidth: 2 },
                        { label: "Val Loss", data: lstm.val_loss, borderWidth: 2 }
                    ]
                }
            });

            new Chart(document.getElementById("lstm_acc"), {
                type: "line",
                data: {
                    labels: lstm.accuracy.map((_, i) => i + 1),
                    datasets: [
                        { label: "Accuracy", data: lstm.accuracy, borderWidth: 2 },
                        { label: "Val Accuracy", data: lstm.val_accuracy, borderWidth: 2 }
                    ]
                }
            });
        }

    </script>
</body>
</html>